function checkProperties(e){for(var t in e)console.log(t+": "+e[t])}function renameResult(e){function t(){function e(e){document.getElementById("saveAsPublicCheckbox").checked&&(e.ifPublic=!0,e.groups=getSelectedUserGroups()),WireIt.adapters.NodeConnector.renameRun(e,function(e){var t=e.id;if(loadResultDialogOpen&&(document.getElementById("name"+t).innerHTML=e.name,document.getElementById("description"+t).innerHTML=e.description),null!=document.getElementById(e.id)){var i=document.createElement("div"),n=document.getElementById(t);i.innerHTML=e.name+"&nbsp;",i.id=n.id,i.description=n.description,i.className=n.className,n.parentNode.replaceChild(i,n);var s=document.getElementById(e.id).parentNode.getElementsByClassName("descriptionResult")[0],o=document.createElement("div");o.innerHTML=e.description+"&nbsp;",o.className=s.className,s.parentNode.replaceChild(o,s)}})}this.renameDialog=new YAHOO.widget.Dialog("WiringEditor-saveDialog",{fixedcenter:!0,draggable:!0,width:"500px",visible:!1,modal:!0});var t=[{text:"Ok",handler:function(){i.name=document.getElementById("wfnameInput").value,i.description=document.getElementById("wfdescInput").value,(i.name!=n||i.description!=s)&&e(i),this.cancel()}},{text:"Cancel",handler:function(){this.cancel()}}],o="new name",a="new description";""!=n.trim()&&(o=n),""!=s.trim()&&(a=s),this.renameDialog.cfg.queueProperty("buttons",t),this.renameDialog.setHeader("Rename Run..."),this.renameDialog.setBody("<br /><p style='font-style: italic'>Please enter some run information:</p><br /><p><label for='wfname'>Run Name:</label><br/><input type='text' name='wfname' id='wfnameInput' size='40' value='"+o+"' /></p><br />"+"<p><label for='wfdesc'>Run Description:</label><br/><textarea name='wfdesc' id='wfdescInput' cols='40' rows='5'>"+a+"</textarea></p>"+"<br/><br/><label style='font-style:italic' for='saveAsPublicCheckbox'>make public?&nbsp;</label><br />"+"<input onClick='toggleUserGrpsActive()' type='checkbox' name='saveAsPublicCheckbox' id='saveAsPublicCheckbox' /><br/>"+"</p><br/> "+r+"<br/>"),this.renameDialog.postmethod="none",this.renameDialog.render(document.body),this.renameDialog.show()}var i={},n="",s="";loadResultDialogOpen?(i.id=e.getAttribute("wf"),n=e.parentNode.getElementsByClassName("trName")[0].innerHTML,s=e.parentNode.getElementsByClassName("trDescription")[0].innerHTML):(i.id=e.parentNode.getElementsByClassName("nameResult")[0].id,n=e.parentNode.getElementsByClassName("nameResult")[0].innerHTML,s=e.parentNode.getElementsByClassName("descriptionResult")[0].innerHTML);var o,r="";WireIt.adapters.NodeConnector.getUserGroups(function(e){o=e,o.length>=1?WireIt.adapters.NodeConnector.getGroupNames(e,function(e){r+="<div id='userGroupDiv' >";for(var i=0;i<o.length;i++)r+="<input disabled checked type='checkbox' class='userGrpsCb' id='"+o[i]+"'>"+e[i]+"</input>";r+="</div>",t()}):t()})}function renameAutosave(e){var t={};t.id=e.getAttribute("saveid"),t.name=document.getElementById("wfnameInput").value,t.description=document.getElementById("wfdescInput").value,document.getElementById("saveAsPublicCheckbox").checked&&(t.ifPublic=!0,t.groups=getSelectedUserGroups()),t.id&&t.name&&t.description&&WireIt.adapters.NodeConnector.renameAutosave(t,function(e){var t=document.getElementById(e.id).parentNode,i=t.getElementsByClassName("trName")[0],n=t.getElementsByClassName("trDescription")[0];i.innerHTML=e.name,n.innerHTML=e.description})}function highlightLoadSelection(e){var t=parseInt(e.getAttribute("loadid")),i=e.getAttribute("indexid");document.getElementById("wfselectionInput").setAttribute("indexid",i,0);var n=e.parentNode.childNodes;"wfselectionInput"==e.getAttribute("id")&&(n=e.parentNode.parentNode.getElementsByClassName("loadTable")[actualTable].getElementsByTagName("tbody")[0].getElementsByTagName("tbody")[0].childNodes),actualTableEls=n;var s=n.length;if(this.lastLoadIndex||(this.lastLoadIndex=-1),s>=t&&t>=0){for(var o,r=0;s>r;r++)parseInt(n[r].getAttribute("loadid"))==parseInt(this.lastLoadIndex)&&(o=n[r],o.style.color=listColorTRfont,o.style.background=0==r%2?listColorTRbg1:listColorTRbg2);this.lastLoadIndex=t;for(var r=0;s>r;r++)parseInt(n[r].getAttribute("loadid"))==this.lastLoadIndex&&(o=n[r]);document.getElementById("wfselectionInput").value=t,o.style.background=listColorTRactiveBg,o.style.color=listColorTRactiveFont,rowStyleTmp[0]=o.style.color,rowStyleTmp[1]=o.style.background}else for(var o,r=0;s>r;r++)parseInt(n[r].getAttribute("loadid"))==parseInt(this.lastLoadIndex)&&(o=n[r],o.style.color=listColorTRfont,o.style.background=0==r%2?listColorTRbg1:listColorTRbg2)}function changeTable(e){document.getElementById("wfselectionInput").value="";try{colorTableList(actualTableEls)}catch(t){}actualTable=e;for(var i=document.getElementsByClassName("tableSwitchBtn"),n=0;n<i.length;n++)i[n].style.border=switchBTNborder;i[e].style.border=switchBTNborderActive;for(var s=document.getElementsByClassName("loadTable"),n=0;n<s.length;n++)s[n].style.display="none",n==e&&(s[n].style.display="")}function calculateWorkflowID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),i="x"==e?t:8|3&t;return i.toString(16)})}function parseDate(e){var t=Number(e.substring(0,4)),i=Number(e.substring(4,6))-1,n=Number(e.substring(6,8)),s=Number(e.substring(8,10)),o=Number(e.substring(10,12)),r=Number(e.substring(12,14)),a=new Date;return a.setUTCFullYear(t),a.setUTCMonth(i),a.setUTCDate(n),a.setUTCHours(s),a.setUTCMinutes(o),a.setUTCSeconds(r),a}function hoverLoadTableEl(e){if(void 0!=e&&null!=e){rowStyleTmp[0]=e.parentNode.style.color,rowStyleTmp[1]=e.parentNode.style.background,e.parentNode.style.color=listColorTRfontActive,e.parentNode.style.background=listColorTRbgActive;var t=e.innerHTML;tooltipHover(e,t)}}function tooltipHover(e,t){void 0!=e&&null!=e&&(tooltipDisplayed||(ttTimer=setTimeout('createDescriptionTooltip("'+escape(t)+'")',500),YAHOO.util.Event.addListener(e,"mousemove",function(e){cX=YAHOO.util.Event.getXY(e)[0],cY=YAHOO.util.Event.getXY(e)[1]},this,!0)))}function resetHoverLoadTableEl(e){void 0!=e&&null!=e&&(e.parentNode.style.color=rowStyleTmp[0],e.parentNode.style.background=rowStyleTmp[1]),tooltipHoverReset(e)}function tooltipHoverReset(e){void 0!=e&&null!=e&&(clearTimeout(ttTimer),null!=ttTimer&&(ttTimer=null),document.getElementById("loadTableDescriptionTooltip")&&document.getElementsByTagName("body")[0].removeChild(document.getElementById("loadTableDescriptionTooltip")),tooltipDisplayed=!1)}function createDescriptionTooltip(e){null!=ttTimer&&(ttTimer=null),document.getElementById("loadTableDescriptionTooltip")&&document.getElementsByTagName("body")[0].removeChild(document.getElementById("loadTableDescriptionTooltip"));var t=document.createElement("div");t.id="loadTableDescriptionTooltip",t.style.opacity="0",t.style.color="black",t.style.background="white",t.style.left=cX+10+"px",t.style.top=cY+10+"px";var i=document.createTextNode(unescape(e));t.appendChild(i),document.getElementsByTagName("body")[0].appendChild(t),tooltipDisplayed=!0,fade("loadTableDescriptionTooltip")}function sortTable(e){document.getElementById("wfselectionInput").value="";var t=e.innerHTML,i=e.parentNode.parentNode.getElementsByTagName("tbody")[0],n="tr"+t,s=i.getElementsByClassName(n),o=new Array(s.length);if(sortCat==t)for(var r=0;r<s.length;r++){var a=s[r].parentNode;o[o.length-r-1]=a}if(sortCat!=t)for(var l=checkifnumbers(s),r=0;r<s.length;r++)for(var a=s[r].parentNode,u=s[r],c=0;c<o.length;c++){if(l&&o[c]&&parseFloat(o[c].getElementsByClassName(n)[0].innerHTML)>parseFloat(u.innerHTML)){for(k=o.length-1;k>c;k--)o[k]=o[k-1];o[c]=a;break}if(!l&&o[c]&&o[c].getElementsByClassName(n)[0].innerHTML>u.innerHTML){for(k=o.length-1;k>c;k--)o[k]=o[k-1];o[c]=a;break}if(!o[c]){o[c]=a;break}}for(;i.childNodes.length>0;)i.removeChild(i.childNodes[0]);for(var r=0;r<o.length;r++)i.appendChild(o[r]);ths=e.parentNode.childNodes;for(var h=0;h<ths.length;h++)ths[h].style.color=listColorTH;e.style.color=listColorTHactive,sortCat=t,colorTableList(i.childNodes)}function colorTableList(e){for(var t=0;t<e.length;t++)e[t].style.color=listColorTRfont,e[t].style.background=0==t%2?listColorTRbg1:listColorTRbg2}function checkifnumbers(e){for(var t=0;t<e.length;t++)if(!parseInt(e[t].innerHTML[0])&&"0"!=e[t].innerHTML[0]){if("."!=e[t].innerHTML[0])return!1;if("."==e[t].innerHTML[0]&&!parseFloat(e[t].innerHTML))return!1}return!0}function parseDate(e){var t=Number(e.substring(0,4)),i=Number(e.substring(4,6))-1,n=Number(e.substring(6,8)),s=Number(e.substring(8,10)),o=Number(e.substring(10,12)),r=Number(e.substring(12,14)),a=new Date;return a.setUTCFullYear(t),a.setUTCMonth(i),a.setUTCDate(n),a.setUTCHours(s),a.setUTCMinutes(o),a.setUTCSeconds(r),a}function fade(e){var t=document.getElementById(e);null!=t&&(null==t.FadeState&&(t.FadeState=null==t.style.opacity||""==t.style.opacity||"1"==t.style.opacity?2:-2),1==t.FadeState||-1==t.FadeState?(t.FadeState=1==t.FadeState?-1:1,t.FadeTimeLeft=TimeToFade-t.FadeTimeLeft):(t.FadeState=2==t.FadeState?-1:1,t.FadeTimeLeft=TimeToFade,setTimeout("animateFade("+(new Date).getTime()+",'"+e+"')",33)))}function animateFade(e,t){var i=(new Date).getTime(),n=i-e,s=document.getElementById(t);if(s){if(s.FadeTimeLeft<=n)return s.style.opacity=1==s.FadeState?"1":"0",s.style.filter="alpha(opacity = "+(1==s.FadeState?"100":"0")+")",s.FadeState=1==s.FadeState?2:-2,void 0;s.FadeTimeLeft-=n;var o=s.FadeTimeLeft/TimeToFade;1==s.FadeState&&(o=1-o),s.style.opacity=o,s.style.filter="alpha(opacity = "+100*o+")",setTimeout("animateFade("+i+",'"+t+"')",33)}}function btnSpin(e){function t(e){this.spinner2||(this.spinner2=new Spinner({lines:15,length:1,width:3,radius:8,rotate:0,color:"#333333",speed:2,trail:60,shadow:!1,hwaccel:!0,className:"spinner2",zIndex:2e9,top:"0",left:"0"})),this.spinner2.spin(e)}function i(){this.spinner2.stop()}var n=document.getElementById(e),s=document.getElementById(e+"-button");n.spinning?(n.spinning=!1,i(),s.style.background=this.btnBG):(n.spinning=!0,this.btnBG=s.style.background,s.style.background="transparent",t(n))}function toggleUserGrpsActive(){var e=document.getElementsByClassName("userGrpsCb");if(e.length>0)if(e[0].disabled)for(var t=0;t<e.length;t++)e[t].disabled=!1;else for(var t=0;t<e.length;t++)e[t].disabled=!0}function getSelectedUserGroups(){var e=document.getElementsByClassName("userGrpsCb"),t=[];if(e.length>0)for(var i=0;i<e.length;i++)e[i].checked&&t.push(e[i].id);return t}function deleteSave(e){var t=e.getAttribute("saveid"),i={};i.saveId=t,WireIt.adapters.NodeConnector.getRunNamesForSave(t,function(t){var n="Do you really wish to delete this save?:\n"+e.parentNode.getElementsByClassName("trName")[0].innerHTML;t.length>0&&(n+="and all corresponding runs:",n+=t.toString());var s=window.confirm(n);null!=i.saveId&&void 0!=i.saveId&&s&&WireIt.adapters.NodeConnector.deleteSave(i,function(e){if(e.ok){var t=document.getElementById("del"+e.saveId).parentNode,i=t.parentNode;i.removeChild(t),colorTableList(i.childNodes)}})})}function deleteRun(e){var t={};t.runId=e.getAttribute("wf");var i=window.confirm("Do you really wish to delete this run?");null!=t.runId&&void 0!=t.runId&&i&&WireIt.adapters.NodeConnector.deleteRun(t,function(e){if(e.ok){var t=document.getElementById("del"+e.runId);if(null!=t){var i=t.parentNode,n=i.parentNode;n.removeChild(i),colorTableList(n.childNodes)}var s=document.getElementById("run"+e.runId);null!=s&&s.parentNode.removeChild(s)}})}var util=YAHOO.util,lang=YAHOO.lang,Event=util.Event,Dom=util.Dom,Connect=util.Connect,widget=YAHOO.widget;workbench_work_parent=function(){this.adapter=0==wbConType?WireIt.adapters.TSConnector:WireIt.adapters.NodeConnector,this.renderSavedStatus()},workbench_work_parent.prototype={tsLoad:function(e){setTimeout(function(){$.mobile.loading("show")},1);var t=e.data;actualTable=0;var i=t;t.adapter.getLoadableWirings(function(e){console.log("getLoadableWirings"),console.log(e),null==e&&(e=[]),actualTable=0,sortCat="",e.reverse();var n=[],s=15*e.length<=window.innerHeight/2?15*e.length:window.innerHeight/2;60>s&&(s=60);var o="<p style='font-style:italic;margin-bottom:3px'>Please select one of the following workflows...</p><br /><div style=\"float:left;\"><div style=\"border:2px solid gray\" class='tableSwitchBtn' onclick='changeTable(0)'>named saves</div><div style=\"border:2px solid lightgray\" class='tableSwitchBtn' onclick='changeTable(1)'>autosaves</div></div><div style=\"clear:both\" /><br />";o+="<div id='wiringsIndex' style='display:none;'></div>";var r='<table style="cursor:pointer;width:100%;" class="loadTable" border=\'0\'>';r+="<tr style='font-weight:bold;border-bottom: 1px solid gray;'><th onclick='sortTable(this)' width='10%'>Index</th><th onclick='sortTable(this)' width='20%'>Name</th><th onclick='sortTable(this)' width='20%'>Description</th><th onclick='sortTable(this)' width='25%'>Date</th><th onclick='sortTable(this)' width='15%'>Edit</th><th onclick='sortTable(this)' width='10%'>Delete</th></tr><tr><td colspan='6'><div style='height:"+s+"px; overflow:auto'>"+"<table border='0' width='100%'>";for(var a=0,l=0;l<e.length;l++){var u=e[l],c=u.saveid;if(n.push(c),"autosave"!=u.name){var h="";0==a%2&&(h="style='background:lightgray'"),r+="<tr "+h+'onClick="javascript:highlightLoadSelection(this)" indexid=\''+l+"' loadid='"+(a+1)+"' name='loadSelection'>"+'<td class="trIndex" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'10%\'>'+(a+1)+"</td>"+'<td class="trName" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'20%\'>'+u.name+"</td>"+'<td class="trDescription" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" style=\'\' width=\'20%\'>'+u.description+'<td class="trDate" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'25%\'>'+parseDate(u.date)+"</td>"+'<td class="trEdit" id=\''+c+"' saveid=\""+c+'" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'15%\'>rename</td>'+'<td class="trDelete" id=\'del'+c+"'saveid=\""+c+'" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'10%\'>x</td>'+"</td></tr>",a++}}r+="</table></div></td></tr>",r+="</tbody></table>";var d='<table style="display:none;cursor:pointer;width:100%;"class="loadTable" border=\'0\' width=\'100%\' style="display:">';d+="<tr style='font-weight:bold;border-bottom: 1px solid gray;'><th onclick='sortTable(this)' width='10%'>Index</th><th onclick='sortTable(this)' width='20%'>Name</th><th onclick='sortTable(this)' width='20%'>Description</th><th onclick='sortTable(this)' width='25%'>Date</th><th onclick='sortTable(this)' width='15%'>Edit</th><th onclick='sortTable(this)' width='10%'>Delete</th></tr><tr><td colspan='6'><div style='height:"+s+"px; overflow:auto'>"+"<table border='0' width='100%'>",a=0;for(var l=0;l<e.length;l++){var u=e[l];if("autosave"==u.name){var c=u.saveid,h="";0==l%2&&(h="style='background:lightgray'"),d+="<tr "+h+'onClick="javascript:highlightLoadSelection(this)" indexid=\''+l+"' loadid='"+(a+1)+"' name='loadSelection'>"+'<td class="trIndex" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'10%\'>'+(a+1)+"</td>"+'<td class="trName" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'20%\'>'+u.name+"</td>"+'<td onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" class="trDescription" width=\'20%\'>'+u.description+"</td>"+'<td class="trDate" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'25%\'>'+parseDate(u.date)+"</td>"+'<td class="trEdit" id=\''+c+"' saveid=\""+c+'" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'15%\'>rename</td>'+'<td class="trDelete" id=\'del'+c+"'saveid=\""+c+'" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'10%\'>x</td>'+"</tr>",a++}}d+="</table></div></td></tr>",d+="</tbody></table>";var p='<div style="width:100%">'+r+d+"</div><br/>",f="<button data-inline='true' id='loadButton'>Load</button><button data-inline='true' id='importButton'>Import from JSON</button>",m=o+p+"<p><label for='wfselection' style='font-style: italic'>Selected Workflow:</label><br/><input size='3' maxlength='10' onkeyup='this.setAttribute(\"loadid\", this.value, 0), highlightLoadSelection(this)' loadid='' type='integer' name='wfselection' id='wfselectionInput' /></p>";m+=f,$("#loadDialogContent").html(m),$("#loadButton").on("click",function(){var t=document.getElementById("wfselectionInput").getAttribute("indexid"),n=parseInt(t),s=e[n];console.log("selectedWiring"),console.log(s);var o=s.wiring;i.tsLoadPipe(o),$("#loadDialog").dialog("close"),setTimeout(function(){$.mobile.loading("show")},1),setTimeout(function(){$.mobile.loading("hide")},1500)}),$("#importButton").on("click",function(){var e=prompt("Please supply a workflow in JSON format.","");if(null!=e)try{JSON.parse(e),i.tsLoadPipe(e),$("#loadDialog").dialog("close")}catch(t){alert("No valid JSON. \n"+t)}}),t.adapter.getOwnedSaves(function(e){for(var t=0;t<n.length;t++){var s=n[t],o=document.getElementById(s),r="del"+n[t],a=document.getElementById(r);commonValue(e,[s])?($(o).on("vmousedown",function(e){i.renderRenameDialog(e.target)},this,!0),$(o).on("vmousedown",function(e){deleteSave(e.target)},this,!0)):(o.style.color="gray",a.style.color="gray")}}),$("#loadDialog").trigger("create"),$.mobile.changePage("#loadDialog",{role:"dialog"}),setTimeout(function(){$.mobile.loading("hide")},1)})},tsLoadPipe:function(e){if(console.log("tsLoadPipe"),console.log(e),e=YAHOO.lang.JSON.parse(e),this.isSaved()||confirm("Warning: Your work is not saved yet ! Press ok to continue anyway.")){if(this.preventLayerChangedEvent=!0,this.layer.clear(),lang.isArray(e.modules)){for(i=0;i<e.modules.length;i++){var t=e.modules[i];if(!this.modulesByName[t.name])throw new Error("WiringEditor: module '"+t.name+"' not found !");var n=this.modulesByName[t.name].container;YAHOO.lang.augmentObject(t.config,n),t.config.title=t.name;var s=this.layer.addContainer(t.config);Dom.addClass(s.el,"WiringEditor-module-"+t.name),s.setValue(t.value)}if(lang.isArray(e.wires))for(i=0;i<e.wires.length;i++)this.layer.addWire(e.wires[i])}this.markSaved(),this.preventLayerChangedEvent=!1}},renderSavedStatus:function(){this.savedStatusEl=$("#saveIndicator")},markSaved:function(){this.savedStatusEl.hide()},setSavedWfId:function(e){this.savedStatusEl.savedWfId=e,console.log("WfId: "+this.savedStatusEl.savedWfId)},getSavedWfId:function(){return void 0==this.savedStatusEl.savedWfId&&(this.savedStatusEl.savedWfId=""),console.log("get WfId "+this.savedStatusEl.savedWfId),this.savedStatusEl.savedWfId},markUnsaved:function(){console.log(this.savedStatusEl),this.savedStatusEl.css("display","inline-block"),this.savedStatusEl.savedWfId="",console.log("mark unsaved + WfId ")},isSaved:function(){return"none"==this.savedStatusEl.css("display")},onSave:function(e){var t=e.data;t.renderSaveDialog()},renderSaveDialog:function(){function e(e){i.currentWiring=i.getValue();var t="<br /><p style='font-style: italic'>Please enter some workflow information:</p><br /><p><label for='wfname'>Workflow Name:</label><br/><input type='text' name='wfname' id='wfnameInput' size='40' /></p><br /><p><label for='wfdesc'>Workflow Description:</label><br/><textarea name='wfdesc' id='wfdescInput' cols='40' rows='5'></textarea></p><br /><br />";e&&(t+="<p><label style='font-style:italic' for='saveAsPublicCheckbox'>make public?&nbsp;</label><br /><input onClick='toggleUserGrpsActive()' type='checkbox' name='saveAsPublicCheckbox' id='saveAsPublicCheckbox' /><br/></p><br/> "+n+"<br/>"),t+="<fieldset>",t+="<button data-inline='true' data-theme='b' id='saveDialogOK'>Save</button>",t+="<button data-inline='true' id='saveDialogExport'>Export</button>",t+="<fieldset>",$("#saveDialogContent").html(t),$("#saveDialogOK").on("click",function(){console.log("save"),i.onSaveWiring.call(i)}),$("#saveDialogExport").on("click",function(){i.onExportWorkflow()}),$("#saveDialog").trigger("create"),$.mobile.changePage("#saveDialog")}var t,i=this,n="";i.adapter.getUserGroups(function(s){t=s,t.length>=1?i.adapter.getGroupNames(s,function(i){n+="<div id='userGroupDiv' >";for(var s=0;s<t.length;s++)n+="<input disabled checked type='checkbox' class='userGrpsCb' id='"+t[s]+"'>"+i[s]+"</input>";n+="</div>",console.log("if"),e(!0)}):(console.log("else"),e(!1))})},onSaveWiring:function(){var e,t=document.getElementById("wfnameInput").value,i=document.getElementById("wfdescInput").value,n=!1,s=!1,o="user",r=document.getElementById("saveAsPublicCheckbox");null!=r&&r.checked&&(s=!0,o="public",e=getSelectedUserGroups());var a;a=this.currentWiring;var l={name:a.name,working:a.working,language:"SISOB Language"};this.adapter.saveWiringExtended(l,{shortname:t,description:i,username:this.loginName,sharing:o,groups:e,template:n},{success:this.saveModuleSuccess,failure:this.saveModuleFailure,scope:this}),$("#saveDialog").dialog("close")},getValue:function(){var e,t={modules:[],wires:[],properties:null};for(console.log("getValue"),e=0;e<this.layer.containers.length;e++)t.modules.push({name:this.layer.containers[e].title,value:this.layer.containers[e].getValue(),config:this.layer.containers[e].getConfig()}),console.log(this.layer.containers[e].getConfig());for(e=0;e<this.layer.wires.length;e++){var i=this.layer.wires[e],n=i.getConfig();n.src={moduleId:WireIt.indexOf(i.terminal1.container,this.layer.containers),terminal:i.terminal1.name},n.tgt={moduleId:WireIt.indexOf(i.terminal2.container,this.layer.containers),terminal:i.terminal2.name},t.wires.push(n)}return{name:"",working:t}},saveModuleSuccess:function(e){this.markSaved(),this.setSavedWfId(e.saveid)},saveModuleFailure:function(e){this.alert("Unable to save the wiring : "+e)},onLoadResults:function(e){var t=e.data;setTimeout(function(){$.mobile.loading("show")},1),t.loadResults()},loadResults:function(){console.log("loadResults");var e=this;console.log(e),e.loadResultsDialogOpen||(console.log("resultsDialogNotOpenYet"),e.loadResultsDialogOpen=!0,setTimeout(function(){$.mobile.loading("show")},1),this.adapter.getLoadableResults(function(t){console.log("getLoadableResults"),null==t&&(t=[]),actualTable=0,sortCat="",t.reverse();var i=15*t.length<=window.innerHeight/2?15*t.length:window.innerHeight/2;60>i&&(i=60);var n="<br /><table class=\"loadTable\" style=\"cursor:pointer\" border='0' width='100%'>";n+="<tr style='font-weight:bold;border-bottom: 1px solid gray;'><th onclick='sortTable(this)' width='10%'>Index</th><th onclick='sortTable(this)' width='20%'>Name</th><th onclick='sortTable(this)' width='25%'>Description</th><th onclick='sortTable(this)' width='22%'>Date</th><th onclick='sortTable(this)' width='13%'>Edit</th><th onclick='sortTable(this)' width='10%'>Delete</th></tr><tr><td colspan='6'><div style='height:"+i+"px; overflow:auto'>"+"<table border='0' width='100%'>";for(var s=[],o=0,r=0;r<t.length;r++){var a=t[r];s.push(a.runid);var l="";0==r%2&&(l="style='background:lightgray'"),n+="<tr "+l+' onClick="javascript:highlightLoadSelection(this)" indexid=\''+r+"' loadid='"+(o+1)+"' name='loadSelection'>"+"<td  onmouseover=\"javascript:hoverLoadTableEl(this)\" onmouseout=\"javascript:resetHoverLoadTableEl(this)\" width='10%' class='trIndex' >"+(r+1)+"</td>"+"<td  id='name"+a.runid+"' onmouseover=\"javascript:hoverLoadTableEl(this)\" onmouseout=\"javascript:resetHoverLoadTableEl(this)\" width='20%' class='trName' wf=\""+a.runid+'">'+a.runname+"</td>"+"<td  id='description"+a.runid+"' onmouseover=\"javascript:hoverLoadTableEl(this)\" onmouseout=\"javascript:resetHoverLoadTableEl(this)\" width='25%' class='trDescription' wf=\""+a.runid+'">'+a.rundescription+"</td>"+"<td  id='date"+a.runid+"' onmouseover=\"javascript:hoverLoadTableEl(this)\" onmouseout=\"javascript:resetHoverLoadTableEl(this)\" width='22%' class='trDate' wf=\""+a.runid+'">'+parseDate(a.rundate)+"</td>"+'<td class="trEdit" id=\'edit'+a.runid+"' wf=\""+a.runid+'" onmouseover="javascript:hoverLoadTableEl(this)" onmouseout="javascript:resetHoverLoadTableEl(this)" width=\'13%\'>rename</td>'+'<td class="trDelete" id=\'del'+a.runid+"'wf='"+a.runid+"' onmouseover='javascript:hoverLoadTableEl(this)' onmouseout=\"javascript:resetHoverLoadTableEl(this)\" width='10%'>x</td>",o++}n+="</table></div></td></tr>",n+="</tbody></table><br/>";var u="<button data-inline='true' id='loadPrevButton'>Load</button>",c="<p style='font-style:italic;'>Please select one of the following runs to load its results...</p>"+n+"<p><label for='wfselection'>Selected run:</label><br/><input size='3' maxlength='10' onkeyup='this.setAttribute(\"loadid\", this.value, 0), highlightLoadSelection(this)' loadid='' type='integer' name='wfselection' id='wfselectionInput' /></p>";c+=u,$("#loadPreviousResultsDialogContent").html(c),$("#loadPreviousResultsDialog").bind("pagehide",function(){e.loadResultsDialogOpen=!1}),$("#loadPrevButton").on("click",function(){var i=document.getElementById("wfselectionInput").value,n=parseInt(i)-1,s=t[n];e.loadResult(s),$("#loadPreviousResultsDialog").dialog("close"),e.loadResultsDialogOpen=!1,$("#right").panel("open")}),e.adapter.getOwnedRuns(function(e){console.log("getOwnedRuns"),console.log(e);for(var t=0;t<s.length;t++){var i="edit"+s[t],n=document.getElementById(i),o="del"+s[t],r=document.getElementById(o);commonValue(e,[s[t]])?(Event.addListener(n,"vmousedown",function(e){renameResult(e.target)},this,!0),Event.addListener(r,"vmousedown",function(e){deleteRun(e.target)},this,!0)):(n.style.color="gray",r.style.color="gray")}}),$("#loadPreviousResultsDialog").trigger("create"),$.mobile.changePage("#loadPreviousResultsDialog",{role:"dialog"}),e.loadResultsDialogOpen=!0,setTimeout(function(){$.mobile.loading("hide")},1)}))},loadResult:function(e){var t=this;this.adapter.getResult(e,function(e){var i={runid:e.runid,rundate:e.rundate,links:e.resultlinks,name:e.runname,description:e.rundescription};t.displayResults(i),e.wfwiring&&t.tsLoadPipe(e.wfwiring)})},onExecute:function(){$("#right").panel("open");var e=this;if(e.layer.containers.length<1)$("#infoTexts").prepend("<div class='wf_empty'>Workflow is empty, nothing to execute!</div>");else{$("#infoTexts wf_empty").remove();for(var t=0;t<e.layer.containers.length;++t)e.layer.containers[t].colorContainerDefault();e.execute()}},execute:function(){var e=this,t=calculateWorkflowID(),i=this.getValue();console.log("execute:"),console.log(i),e.tempSavedWiring={name:i.name,working:i.working,language:"SISOB Language"},console.log(e.tempSavedWiring);var n=function(){e.adapter.executeWiring(t,e.tempSavedWiring,{saveid:e.getSavedWfId(),username:e.loginName},{agent:function(t){e.gotAgentRunStatusChange(t)},run:function(t){e.gotRunStatusChange(t)},scope:e},{success:e.executeModuleSuccess,failure:e.executeModuleFailure,scope:e})};e.startSpinner(t),""==e.getSavedWfId()?e.adapter.saveWiringExtended(this.tempSavedWiring,{shortname:"autosave",description:"Automatically saved on "+(new Date).toLocaleString()+".",username:this.loginName,sharing:"user"},{success:function(t){console.log("autosaved with id "+t.saveid),e.setSavedWfId(t.saveid),n()},failure:e.executeModuleFailure,scope:e}):e.getSavedWfId()&&n()},executeModuleSuccess:function(){},executeModuleFailure:function(){},gotAgentRunStatusChange:function(e){for(var t=!1,i=0;!t&&i<this.currentRunIds.length;i++)this.currentRunIds[i]==e.runid&&(t=!0);if(t){console.log("is monitored"),console.log(this.currentRunProgress);var n=this.getContainerByAgentInstanceId(e.instanceid);if(n)switch(this.highlighted||(this.highlighted=!0),console.log("trying to color for "+e.status),e.status){case 1:n.colorContainerWaiting?n.colorContainerWaiting():n.grey();break;case 2:n.colorContainerWorking?n.colorContainerWorking():n.yellow();break;case 3:this.currentRunProgress++,n.colorContainerDone?n.colorContainerDone():n.green();break;case 5:this.currentRunProgress++,n.colorContainerError?n.colorContainerError():n.red()}document.getElementById("spinnerText").innerHTML="... ("+this.currentRunProgress+"/"+this.currentRunSteps+")"}},getContainerByAgentInstanceId:function(e){for(var t=e.substr(0,e.length-2),i=0;i<this.layer.containers.length;i++){var n=this.layer.containers[i].getXY().toString().replace(",","");if(n==t)return this.layer.containers[i]}},startSpinner:function(e){this.currentRunIds||(this.currentRunIds=[]);var t=!1;0==this.currentRunIds.length&&(t=!0),this.currentRunIds.push(e),this.currentRunSteps=this.layer.containers.length,this.currentRunProgress=0,t&&(new Spinner({lines:15,length:1,width:4,radius:9,rotate:0,color:"#000",speed:1.1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"0",left:"0"}).spin(document.getElementById("spinnerGraphics")),document.getElementById("spinnerText").innerHTML="Executing...")},gotRunStatusChange:function(e){for(var t=-1,i=0;0>t&&i<this.currentRunIds.length;i++)this.currentRunIds[i]==e.runid&&(t=i);t>-1&&(3==Number(e.status)||5==Number(e.status))&&(this.currentRunIds.splice(t,1),3==Number(e.status)?this.handleResults(e.runid,e.rundate):this.handleErrorResults(e.runid,e.rundate),0==this.currentRunIds.length&&(document.getElementById("spinnerGraphics").removeChild(document.getElementById("spinnerGraphics").firstChild),document.getElementById("spinnerText").innerHTML=""))},handleResults:function(e,t){var i={success:function(i){if(i){for(var n=[],s=0;s<i.length;s++)n.push(i[s].resultinfo);var o={runid:e,rundate:t,links:n};this.displayResults(o)}},scope:this};this.adapter.getResults(e,i)},displayResults:function(e){var t=[];t.push("<div class='Workbench-result' id='run"+e.runid+"'>"),t.push("<span>"),t.push("Result for analysis run"),e.name&&e.description?(t.push(' <div class="nameResult" id="'+e.runid+'">'+e.name+"</div>"),t.push(' <div class="descriptionResult">'+e.description+"</div>")):(t.push(' <div class="nameResult" id="'+e.runid+'"></div>'),t.push(' <div class="descriptionResult"></div>')),t.push(" executed on "),t.push(parseDate(e.rundate)),t.push(' <div class="renameResult" wf=\''+e.runid+'\' onclick="renameResult(this)">rename</div>'),t.push(" / "),t.push(' <div class="discardResult" wf=\''+e.runid+'\' onclick="deleteRun(this)">discard</div>'),t.push("<ul>");for(var i=0;i<e.links.length;i++)t.push("<li style='margin-top: 10px;'><a data-role='button' data-theme='b' data-mini='true' data-icon='forward' href=\""+e.links[i]+'" target="_blank">Result link</a></li>');t.push("</ul>"),t.push("</span>"),t.push("</div>");var n=[t.join("")];n.push(document.getElementById("infoTexts").innerHTML),document.getElementById("infoTexts").innerHTML=n.join(""),$("#infoTexts").trigger("create")},handleErrorResults:function(e,t){var i={success:function(i){for(var n=[],s=0;s<i.length;s++)n.push({component:i[s].agentid,instance:i[s].instanceid,message:i[s].errormessage});this.displayErrorResults(e,t,n)},scope:this};this.adapter.getErrorResults(e,i)},displayErrorResults:function(e,t,i){var n=[];n.push('<div class="Workbench-result">'),n.push("<span>"),n.push("Workflow executed on "),n.push(parseDate(t)),n.push(" stopped with errors:"),n.push("<ul>");for(var s=0;s<i.length;s++)n.push("<li>"+i[s].component+" : "+i[s].instance+" : "+i[s].message+"</li>");n.push("</ul>"),n.push("</span>"),n.push("</div>");var o=[n.join("")];o.push(document.getElementById("infoTexts").innerHTML),document.getElementById("infoTexts").innerHTML=o.join("")},onLogout:function(e){var t=e.data;t.logout()},logout:function(){SC.socket.emit("logout")},onExportWorkflow:function(){var e;e=this.currentWiring;var t=YAHOO.lang.JSON.stringify(e.working);alert(t)}};var loadResultDialogOpen=!1,listColorTRbg1="lightgray",listColorTRbg2="",listColorTRfont="black",listColorTRactiveBg="darkblue",listColorTRactiveFont="white",listColorTRbgActive="#CAE1FF",listColorTRfontActive="black",listColorTH="black",listColorTHactive="darkblue",switchBTNborder="2px solid lightgray",switchBTNborderActive="2px solid gray",actualTable=0,actualTableEls,ttTimer=null,rowStyleTmp=[];
rowStyleTmp[0]="",rowStyleTmp[1]="";var cX=0,cY=0,tooltipDisplayed=!1,sortCat="",TimeToFade=400,commonValue=function(e,t){if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=t,n=0;n<e.length;n++)for(var s=0;s<i.length;s++)if(e[n]==i[s])return!0;return!1};adminBtnReady=!1;