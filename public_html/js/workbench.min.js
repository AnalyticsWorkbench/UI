function showLoadingSisob(e){if(e){if(GLOBAL_WORKBENCH_LOADING_VISIBLE)return;msgText="Loading SISOB workbench...",textVisible="Loading...",textonly="Loading...",html="<span class='ui-bar ui-shadow ui-overlay-d ui-corner-all'><img height='40px' src='logos/logo-SISOB-wb.svg'><div class='ui-icon-loading' style='margin: 0 auto .625em; filter: Alpha(Opacity=75); opacity: .75; -webkit-border-radius: 2.25em; border-radius: 2.25em; width: 46px; height:46px;'></div><h2>workbench is loading ...</h2></span>",setTimeout(function(){$.mobile.loading("show",{text:msgText,textVisible:textVisible,textonly:textonly,theme:"a",html:html})},1)}else{if(!GLOBAL_WORKBENCH_LOADING_VISIBLE)return;setTimeout(function(){$.mobile.loading("hide")},1)}GLOBAL_WORKBENCH_LOADING_VISIBLE=e}function prepareWorkbench(e){function t(e){console.log("buildInterface");var t=$("#menuLoad")[0];if(null!=t)return console.log("workbench already initialised."),showLoadingSisob(!1),void 0;showLoadingSisob(!0);for(var n=0;n<e.length;n++)i.modules.push(e[n]);setTimeout(function(){GLOBAL_WORKBENCH=new SISOB.Workbench(i,GLOBAL_USER),showLoadingSisob(!1)},1)}console.log("prepareWorkbench");var i={languageName:"SISOB Analysis",modules:[{name:"Direct Uploader",category:"Input",container:{xtype:"WireIt.SISOBContainer",outputs:[{name:"out_1",label:"uploaded data"}],fields:[{type:"file",label:"Select File",name:"files",required:!0},{type:"boolean",label:"Handle as text?",name:"text"}],descriptionText:"'Handle as text?' determines if the data is handled as text or as binary. If the input is a text file (like most network formats), please check it. In doubt please leave it unchecked.",legend:"This agent will upload a file or a data folder from your local file system, please think of the format conversion into a SISOB format."}}]};showLoadingSisob(!0),GLOBAL_USER=e,SC.sendRequest("getFilterDescriptions",t)}var GLOBAL_WORKBENCH=null,GLOBAL_USER=null,GLOBAL_WORKBENCH_LOADING_VISIBLE=!1;SISOB=function(){return Workbench=function(e,t){this.loginName=t.username,this.user=t,this.options={};var i=this,n="ontouchstart"in window||navigator.msMaxTouchPoints>0;this.isTouchDevice=n,n=!0,navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&n?(this.options.tapToConnect=!0,$("#headerText").append("FOX")):$("#headerText").append(n?"(T)":"(NT)"),SISOB.Workbench.superclass.constructor.call(this),this.modules=e.modules,this.modulesByName=[];for(var s=0;s<this.modules.length;s++){var o=this.modules[s];this.modulesByName[o.name]=o}this.layer=new WireIt.Layer({}),$(".WireIt-Layer").hide(),this.layer.eventChanged.subscribe(this.onLayerChanged,this,!0),this.resizeWorkbench(),this.renderMenus(),this.buildModulesList(),$("#moduleSearch").listview().listview("refresh"),$("#addPanel form").submit(function(){var e=$("#moduleSearch li:visible").data("module-name");console.log(e);var t=i.modulesByName[e];if(t){var n={};n.data=[i,t,"auto submit"],i.moduleClick(n)}}),$(window).resize(this.resizeWorkbench),$(".WireIt-Layer").show()},YAHOO.lang.extend(Workbench,workbench_work_parent,{resizeWorkbench:function(){var e=$("[data-role=header]").outerHeight(),t=$("[data-role=footer]").outerHeight();$(".ui-panel").height();var i=window.innerHeight-e-t,n=i-10;console.log("resizeWorkbench "+i),$(".ui-panel").css({top:e,"min-height":i,height:i,"overflow-x":"none","overflow-y":"auto"}),$(".ui-panel-inner").css({"min-height":i,height:i}),$("#center").css({height:i-5}),$(".WireIt-Layer").css({height:n})},renderMenus:function(){var e=this,t=$("#menuList");t.append("<li data-role='divider' data-theme='b'>Workflow</li>"),t.append("<li id='menuLoad'><a href='#'>Load</a></li>"),$("#menuLoad").on("click",this,this.tsLoad),t.append("<li id='menuSave'><a href='#'>Save</a></li>"),$("#menuSave").on("click",this,this.onSave),t.append("<li id='menuExecuteMenu' class='menuExecute'><a href='#'>Execute</a></li>"),$("#menuExecuteHeader").on("click",function(){try{SC.socket.emit("statistics",{username:e.loginName,action:"menuExecuteHeader"})}catch(t){}e.onExecute.call(e)}),$("#menuExecuteMenu").on("click",function(){try{SC.socket.emit("statistics",{username:e.loginName,action:"menuExecuteMenu"})}catch(t){}$("#popupMenu").popup("close"),e.onExecute.call(e)}),t.append("<li id='menuLoadPrev'><a href='#'>Previous Results</a></li>"),$("#menuLoadPrev").on("click",function(){e.loadResults.call(e)}),$("#btnLoadPreviousResults").on("click",this,this.onLoadResults),t.append("<li id='WiringEditor-adminButton' style='display: none;'><a href='#'>Administration</a></li>"),adminBtnReady=!0,t.append("<li data-role='divider' data-theme='b'>Workbench</li>"),t.append("<li id='menuAbout'><a href='#aboutDialog' data-rel='dialog'>About</a></li>"),t.append("<li id='menuLogout'><a href='/logout' rel='external'>Logout ("+this.user.username+")</a></li>"),t.listview().listview("refresh")},buildModulesList:function(){console.log("buildModulesList");for(var e=0;e<FILTERORDER.length;e++)this.createCategory(FILTERORDER[e]);var t=this.modules;console.log("count "+this.modules.length),t.sort(function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0});for(var e=0;e<t.length;e++)this.addModuleToList(t[e]);var i=this;$(".WireIt-Layer").droppable({drop:function(e,t){if(console.log(t),1!=t.helper.data("dropit"))return console.log("not dropping, was just a scroll"),void 0;var n=Dom.getXY(i.layer.el),s=e.pageX-n[0]+i.layer.el.scrollLeft,o=e.pageY-n[1]+i.layer.el.scrollTop,r=t.draggable[0].id;if(r){var a=i.modulesByName[r];a&&i.addModule(a,[s,o])}},accept:".sisobDraggable"})},createCategory:function(e){var t="module-category-"+e.replace(/\s+/g,"-"),i="list-"+t,n="<div id='"+t+"' data-mini='true' data-role='collapsible' data-collapsed-icon='arrow-r' data-expanded-icon='arrow-d' ";e.indexOf("Input")>-1?(n+="data-collapsed='false' ",n+="data-theme='a' "):n+=e.indexOf("Graph Visualizations")>-1||e.indexOf("Statistical Visualizations")>-1||e.indexOf("Output")>-1?"data-theme='a' ":"data-theme='b' ",n+="data-content-theme='d' data-inset='false'><h3>"+e+"</h3><ul class='"+i+"' data-role='listview'></ul></div>",$(".addContainer").append(n),$("."+i).trigger("create").listview().listview("refresh")},addModuleToList:function(e){var t=e.category||"main",i="module-category-"+t.replace(/\s+/g,"-"),n="list-"+i,s=$("#"+i).get(0);s||this.createCategory(t);var o=e.name.replace(/\s+/g,"-"),r="<li data-icon='plus' id='"+e.name+"' class='"+o+" sisobDraggable' style='z-index: 99;'>"+"<a title='"+e.container.legend+"' href='#'>"+e.name+"</a>"+" <a href='#' >Add</a>"+"</li>";$("."+n).append(r).trigger("create").listview().listview("refresh"),$("."+o).on("click",[this,e],this.moduleClick);var a="auto_"+o;$("#moduleSearch").append("<li  id='"+a+"' class='ui-screen-hidden' data-icon='plus'><a href='#'>"+e.name+"</a><a href='#' >Add</a></li>"),$("#"+a).data("module-name",e.name),$("#"+a).on("click",[this,e],this.moduleClick),$("."+o).draggable({appendTo:"body",containment:"document",helper:"clone",cursor:"move",start:function(e,t){this.myHelper=t.helper,t.helper.hide(),this.wasOutsidePanel=!1},drag:function(e,t){if(e.pageX<200&&!this.wasOutsidePanel){if(this.lastY){var i=e.pageY-this.lastY;i*=-1;var n=$("#addPanel").first().get(0),s=n.scrollTop;0>s+i?n.scrollTop=0:n.scrollTop+=i}}else this.wasOutsidePanel=!0,t.helper.show(),t.helper.data("dropit",!0);this.lastY=e.pageY}}),$("#"+i).collapsible()},moduleClick:function(e){var t=e.data[0],i=e.data[1],n=100,s=20;if(null!=t.lastAddedElement){var o=$("#"+t.lastAddedElement.el.id),r=o.position(),a=o.height();"undefined"!=typeof r&&"undefined"!=typeof a&&(n=r.left+t.layer.el.scrollLeft,s=r.top+a+t.layer.el.scrollTop+50)}var l=t.addModule(i,[n,s]),u=$(l.el);$(".WireIt-Layer").height();var c=l.position[1]+u.height();c=l.position[1],console.log(c),5>c&&(c=5),console.log(t.layer.el.scrollTop),t.layer.el.scrollTop=c},addModule:function(e,t){t[0]<5&&(t[0]=5),t[1]<5&&(t[1]=5);var i=e.container;i.position=t,i.title=e.name;var n=this.layer.addContainer(i),s=$(n.el);this.lastAddedElement=n;var o=e.category||"main";return s.addClass("sisob-module-category-"+o.replace(/ /g,"-")),s.addClass("sisob-module-"+e.name.replace(/ /g,"-")),n},onLayerChanged:function(){this.preventLayerChangedEvent||(this.markUnsaved(),this.currentRunIds&&0==this.currentRunIds.length&&this.highlighted&&(this.decolorAllContainers(),this.highlighted=!1))},connectTerminals:function(e,t){if(console.log("connectTerminals"),null==e||null==t)return console.log("terminal null"),void 0;var i,n=!1;for(i=0;i<e.wires.length;i++)if(e.wires[i].terminal1==e){if(e.wires[i].terminal2==t){n=!0;break}}else if(e.wires[i].terminal2==e&&e.wires[i].terminal1==t){n=!0;break}if(!n){var s=e.parentEl.parentNode;e.container&&(s=e.container.layer.el);var o=e,r=t;r.alwaysSrc&&(o=t,r=e);var a,l=WireIt.wireClassFromXtype(o.wireConfig.xtype),u=t;1==u.nMaxWires?(u.wires.length>0&&u.wires[0].remove(),a=new l(o,r,s,o.wireConfig),a.redraw()):u.wires.length<u.nMaxWires&&(a=new l(o,r,s,o.wireConfig),a.redraw()),o.parentEl.id,r.parentEl.id}}}),{Workbench:Workbench}}();